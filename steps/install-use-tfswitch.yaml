---
parameters:
  - name: workingDirectory
    default: $(System.DefaultWorkingDirectory)
  - name: tfswitchArgs
    default: ''
steps:
  - task: Bash@3
    displayName: Terraform install (tfswitch)
    env:
      BINDIR: ~/.local/bin
    inputs:
      targetType: 'inline'
      script: |
        curl -L https://raw.githubusercontent.com/warrensbox/terraform-switcher/release/install.sh | bash -s -- -b  ~/.local/bin latest
        set -x
        # Make sure ~/.local/bin is set for both root and non-root based agents (self-hosted etc)
        echo '##vso[task.prependpath]$(HOME)/.local/bin'
        tfswitch ${{ parameters.tfswitchArgs }}
      workingDirectory: ${{ parameters.workingDirectory}}
