---
parameters:
  - name: workingDirectory
    default: $(System.DefaultWorkingDirectory)
  - name: tfswitchArgs
    default: ""
  - name: tfswitchVersion
    default: "1.1.0"
  - name: tfswitchPath
    default: "/home/vsts/.local/bin"  # Replace "~" with "/home/vsts"
steps:
  - task: Bash@3
    displayName: Terraform install (tfswitch)
    env:
      BINDIR: /home/vsts/.local/bin  # Replace "~" with "/home/vsts"
    inputs:
      targetType: "inline"
      script: |
        curl -L https://raw.githubusercontent.com/warrensbox/terraform-switcher/release/install.sh | bash -s -- -b  ${{ parameters.tfswitchPath }} ${{ parameters.tfswitchVersion }}
        set -x
        # Make sure /home/vsts/.local/bin is set for both root and non-root based agents (self-hosted etc)
        # Prepend PATH for other ADO tasks
        echo "##vso[task.prependpath]${{ parameters.tfswitchPath }}"
        # Prepend PATH for current ADO task
        export PATH=${{ parameters.tfswitchPath }}:$PATH
        tfswitch ${{ parameters.tfswitchArgs }}
      workingDirectory: ${{ parameters.workingDirectory}}