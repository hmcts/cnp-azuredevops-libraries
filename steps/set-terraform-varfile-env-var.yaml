parameters:
  terraformVarFile: ''
  environment: ''

steps:
  - pwsh: |
      $terraformVarFile = $env:terraformVarFile
      $environment = $env:environment

      if ([string]::IsNullOrWhiteSpace($terraformVarFile)) {
         $TERRAFORM_VAR_FILE = "$(System.DefaultWorkingDirectory)/$(buildRepoSuffix)/environments/$environment/$(tfVarsName).tfvars"
         $SPECIFY_VAR_FILE_COMMAND_OPTION = $True
      } elseif ("none" -eq "$terraformVarFile".ToLower()) {
          $SPECIFY_VAR_FILE_COMMAND_OPTION = $False
      } else {
         $TERRAFORM_VAR_FILE = $terraformVarFile
         $SPECIFY_VAR_FILE_COMMAND_OPTION = $True
      }

      if ($SPECIFY_VAR_FILE_COMMAND_OPTION -eq $True) {
          $TERRAFORM_VAR_FILE_COMMAND_OPTION = "-var-file=""$TERRAFORM_VAR_FILE"""
       } else {
          $TERRAFORM_VAR_FILE_COMMAND_OPTION = ""
      }

      Write-Host "##vso[task.setvariable variable=tfVarFileCommandOption]$TERRAFORM_VAR_FILE_COMMAND_OPTION"
    displayName: Set terraform var-file command option
    env:
      terraformVarFile: ${{ parameters.terraformVarFile }}
      environment: ${{ parameters.environment }}
