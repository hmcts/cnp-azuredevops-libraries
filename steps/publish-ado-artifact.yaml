parameters:
  - name: artifactVersion
    type: string

steps:
  - task: AzureKeyVault@2
    displayName: Azure Key Vault
    inputs:
      azureSubscription: 'DTS-CFTPTL-INTSVC'
      KeyVaultName: 'cftptl-intsvc'
      SecretsFilter: 'AZURE-DEVOPS-ARTIFACT-USERNAME, AZURE-DEVOPS-ARTIFACT-TOKEN'

  - script: |
      ./gradlew clean publish
    env:
      AZURE_DEVOPS_ARTIFACT_USERNAME: $(AZURE-DEVOPS-ARTIFACT-USERNAME)
      AZURE_DEVOPS_ARTIFACT_TOKEN: $(AZURE-DEVOPS-ARTIFACT-TOKEN)
      RELEASE_VERSION: ${{ parameters.artifactVersion }}
    displayName: 'Publish to Azure DevOps Artifacts'
